<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Playpen - F0UND3RZ G4M3</title>
    <style>
        /* CSS VARIABLES */
        :root {
            --purple: #8A2BE2;
            --cyan: #00FFFF;
            --yellow: #FFFF00;
            --pink: #FF69B4;
            --team1-color: #DC143C; /* Crimson Red - Y2Ket Corp */
            --team2-color: #00BFFF; /* Deep Sky Blue - Series A(pocalypse) */
            --glass: rgba(255,255,255,0.08);
            --blur: 10px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* BACKGROUND - Same as main game */
        .liminal-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-color: #000;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* PLAYFUL HEADER */
        .header {
            background: transparent;
            padding: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 3px solid #fff;
        }

        .header::before {
            content: 'üß∏üß©üéàüöÇü™ÄüèóÔ∏èüé®üéØüß∏üß©üéàüöÇü™ÄüèóÔ∏èüé®üéØ';
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            font-size: 20px;
            opacity: 0.3;
            animation: slide 15s linear infinite;
        }

        @keyframes slide {
            0% { left: -200px; }
            100% { left: 100%; }
        }

        .header h1 {
            font-size: 32px;
            font-weight: 900;
            color: #fff;
            text-shadow: 
                0 0 20px rgba(255,255,255,0.5),
                3px 3px 0 #000;
            letter-spacing: 3px;
            text-transform: uppercase;
            animation: wobble 2s ease-in-out infinite;
        }

        @keyframes wobble {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        /* NAVIGATION BUTTONS */
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: var(--glass);
            backdrop-filter: blur(var(--blur));
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: #fff;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            transform: rotate(-2deg);
        }

        .nav-button:nth-child(1) {
            border-color: var(--purple);
            background: rgba(138,43,226,0.1);
        }

        .nav-button:nth-child(2) {
            border-color: var(--cyan);
            background: rgba(0,255,255,0.1);
            transform: rotate(2deg);
        }

        .nav-button:hover {
            transform: rotate(0deg) scale(1.1);
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        .nav-button:nth-child(1):hover {
            border-color: var(--yellow);
            box-shadow: 0 0 30px rgba(255,255,0,0.3);
        }

        .nav-button:nth-child(2):hover {
            border-color: var(--pink);
            box-shadow: 0 0 30px rgba(255,105,180,0.3);
        }

        .nav-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            object-fit: cover;
            border: 2px solid rgba(255,255,255,0.3);
            animation: float 3s ease-in-out infinite;
        }

        .nav-button:nth-child(2) .nav-icon {
            animation-delay: 1.5s;
        }

        .nav-text {
            font-size: 20px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px currentColor;
        }

        .nav-button:nth-child(1) .nav-text {
            color: var(--purple);
            text-shadow: 0 0 15px var(--purple);
        }

        .nav-button:nth-child(2) .nav-text {
            color: var(--cyan);
            text-shadow: 0 0 15px var(--cyan);
        }

        /* SCORE DISPLAY */
        .scores {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px;
            flex-wrap: wrap;
        }

        .company-score {
            background: var(--glass);
            backdrop-filter: blur(var(--blur));
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            transform: rotate(-2deg);
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        /* Team avatars */
        .team-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid;
            object-fit: cover;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .company-score:nth-child(1) {
            border-color: var(--team1-color);
        }

        .company-score:nth-child(1) .company-name {
            color: var(--team1-color);
            text-shadow: 0 0 10px var(--team1-color);
        }

        .company-score:nth-child(1) .team-avatar {
            border-color: var(--team1-color);
            box-shadow: 0 0 15px var(--team1-color);
        }

        .company-score:nth-child(2) {
            border-color: var(--team2-color);
            transform: rotate(2deg);
        }

        .company-score:nth-child(2) .company-name {
            color: var(--team2-color);
            text-shadow: 0 0 10px var(--team2-color);
        }

        .company-score:nth-child(2) .team-avatar {
            border-color: var(--team2-color);
            box-shadow: 0 0 15px var(--team2-color);
        }

        .company-score:hover {
            transform: rotate(0deg) scale(1.05);
        }

        .company-name {
            font-size: 18px;
        }

        .company-valuation {
            font-size: 28px;
            color: var(--yellow);
            text-shadow: 0 0 15px var(--yellow);
            font-weight: 900;
        }

        /* MAIN LAYOUT */
        .game-area {
            display: flex;
            gap: 20px;
            padding: 20px;
            min-height: calc(100vh - 250px);
        }

        /* PLAYPEN CONTAINER */
        .playpen-container {
            flex: 1;
            position: relative;
            min-height: 400px;
            background: rgba(255,255,255,0.02);
            border-radius: 20px;
            padding: 20px;
            overflow: hidden;
        }

        /* FOUNDER CARDS - Draggable */
        .founder-card {
            position: absolute;
            width: 100px;
            height: 120px;
            cursor: move;
            cursor: grab;
            transition: transform 0.2s ease;
            user-select: none;
            -webkit-user-drag: element;
            touch-action: none;
        }

        .founder-card:active {
            cursor: grabbing;
        }

        .founder-card.dragging {
            z-index: 1000;
            transform: scale(1.1) rotate(0deg) !important;
            opacity: 0.8;
        }

        .founder-card-inner {
            width: 100%;
            height: 100%;
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 3px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .founder-card.team-1 .founder-card-inner {
            border-color: var(--team1-color);
            background: rgba(220,20,60,0.1);
        }

        .founder-card.team-2 .founder-card-inner {
            border-color: var(--team2-color);
            background: rgba(0,191,255,0.1);
        }

        .founder-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.5);
            margin-bottom: 5px;
            object-fit: cover;
        }

        .founder-name {
            font-size: 9px;
            color: #fff;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
            line-height: 1.1;
        }

        /* ZONES */
        .zones-container {
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .zone {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            padding: 20px;
            min-height: 150px;
            position: relative;
            transition: all 0.3s ease;
        }

        .zone.drag-over {
            border-color: var(--yellow);
            background: rgba(255,255,0,0.1);
            transform: scale(1.02);
        }

        .zone-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            color: var(--cyan);
            text-shadow: 0 0 10px var(--cyan);
        }

        /* IRS ZONE */
        .irs-zone {
            border-color: #ff0000;
            background: rgba(255,0,0,0.05);
        }

        .irs-zone .zone-title {
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
        }

        .irs-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            display: block;
            opacity: 0.8;
        }

        /* ZONE CONTENTS */
        .zone-contents {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            min-height: 60px;
        }

        /* FOUNDER DETAILS POPUP */
        .founder-details {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid var(--cyan);
            border-radius: 20px;
            padding: 30px;
            z-index: 2000;
            max-width: 400px;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }

        .founder-details.active {
            display: block;
            animation: popup 0.3s ease-out;
        }

        @keyframes popup {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .details-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .details-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--cyan);
        }

        .details-info h3 {
            color: var(--cyan);
            font-size: 20px;
            margin-bottom: 5px;
        }

        .details-wealth {
            color: var(--yellow);
            font-size: 24px;
            font-weight: bold;
        }

        .achievements-list {
            margin-top: 20px;
        }

        .achievements-list h4 {
            color: var(--pink);
            margin-bottom: 10px;
        }

        .achievement-item {
            background: rgba(138,43,226,0.2);
            border-radius: 10px;
            padding: 8px 12px;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .close-details {
            background: var(--pink);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .close-details:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255,105,180,0.5);
        }

        /* MOBILE ADJUSTMENTS */
        @media (max-width: 768px) {
            .header h1 { font-size: 24px; }
            
            .nav-buttons {
                gap: 15px;
                margin: 15px;
            }
            
            .nav-button {
                padding: 10px 15px;
                gap: 10px;
            }
            
            .nav-icon {
                width: 35px;
                height: 35px;
            }
            
            .nav-text {
                font-size: 14px;
            }
            
            .game-area {
                flex-direction: column;
            }
            
            .zones-container {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .zone {
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
            }
            
            .playpen-container {
                min-height: 500px;
                position: relative;
                padding: 10px;
                overflow-y: auto;
                max-height: 70vh;
            }
            
            /* Smaller cards on mobile */
            .founder-card {
                width: 70px !important;
                height: 85px !important;
            }
            
            .founder-card-inner {
                padding: 5px;
            }
            
            .founder-card .founder-image {
                width: 40px;
                height: 40px;
            }
            
            .founder-card .founder-name {
                font-size: 7px;
                line-height: 1;
            }
            
            .company-score {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .company-name {
                font-size: 14px;
            }
            
            .company-valuation {
                font-size: 20px;
            }

            .team-avatar {
                width: 35px;
                height: 35px;
            }
        }

        /* LOADING */
        .loading {
            text-align: center;
            font-size: 24px;
            color: var(--pink);
            margin: 100px 0;
            text-transform: uppercase;
            text-shadow: 2px 2px 0 var(--purple);
        }

        /* Toast notifications */
        @keyframes slide-up {
            0% { transform: translate(-50%, 100%); opacity: 0; }
            100% { transform: translate(-50%, 0); opacity: 1; }
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            border: 2px solid var(--cyan);
            z-index: 10000;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,255,255,0.3);
            backdrop-filter: blur(10px);
            animation: slide-up 0.3s ease-out;
        }
    </style>
</head>
<body>
    <!-- BACKGROUND - Same as main game -->
    <div class="liminal-bg"></div>

    <!-- HEADER -->
    <div class="header">
        <h1>üß∏ THE PLAYPEN üß©</h1>
    </div>

    <!-- NAVIGATION BUTTONS -->
    <div class="nav-buttons">
        <a href="rules.html" class="nav-button">
            <img src="assets/founders/rules.png" alt="Rules" class="nav-icon">
            <span class="nav-text">RULES</span>
        </a>
        <a href="index.html" class="nav-button">
            <img src="assets/founders/board.png" alt="Board" class="nav-icon">
            <span class="nav-text">B0ARD</span>
        </a>
    </div>

    <!-- COMPANY SCORES -->
    <div class="scores">
        <div class="company-score">
            <img src="assets/founders/y2ket.png" alt="Y2Ket Team" class="team-avatar">
            <span class="company-name">Y2KET CORP.</span>
            <span class="company-valuation" id="valuation1">$0</span>
        </div>
        <div class="company-score">
            <img src="assets/founders/series-a.png" alt="Series-A Team" class="team-avatar">
            <span class="company-name">SERIES A(POCALYPSE)</span>
            <span class="company-valuation" id="valuation2">$0</span>
        </div>
    </div>

    <!-- GAME AREA -->
    <div class="game-area">
        <!-- PLAYPEN CONTAINER -->
        <div class="playpen-container" id="playpenContainer">
            <div class="loading">Loading founders...</div>
        </div>

        <!-- ZONES -->
        <div class="zones-container">
            <!-- IRS ZONE -->
            <div class="zone irs-zone" id="irsZone">
                <div class="zone-title">AUDIT BBY</div>
                <img src="assets/founders/irs.png" alt="IRS" class="irs-logo">
                <div class="zone-contents"></div>
            </div>
        </div>
    </div>

    <!-- FOUNDER DETAILS POPUP -->
    <div class="founder-details" id="founderDetails">
        <div class="details-header">
            <img class="details-image" id="detailsImage" src="" alt="">
            <div class="details-info">
                <h3 id="detailsName"></h3>
                <div class="details-wealth" id="detailsWealth">$0</div>
            </div>
        </div>
        <div class="achievements-list">
            <h4>üèÜ Achievements</h4>
            <div id="achievementsList"></div>
        </div>
        <button class="close-details" onclick="closeDetails()">Close</button>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDnHE2Ay2wqZVC4Xf2PsHHppVoVfNPk0hI",
            authDomain: "f0und3rzg4m3-b04rd.firebaseapp.com",
            databaseURL: "https://f0und3rzg4m3-b04rd-default-rtdb.firebaseio.com",
            projectId: "f0und3rzg4m3-b04rd",
            storageBucket: "f0und3rzg4m3-b04rd.firebasestorage.app",
            messagingSenderId: "484982613831",
            appId: "1:484982613831:web:9b655b3d66d66b3b5e8e62",
            measurementId: "G-MPN2LP1Q6X"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Default founder data with Instagram handles - will be loaded from Firebase if available
        let founders = [
            // Y2Ket Corp. (Team 1)
            { id: '30_john_mckafee', name: 'John McAfee', team: 1, wealth: 0, image: '30_john_mckafee.png', handle: '@hauntyourownhouse', company: 'McAfee' },
            { id: '13_jensen_huang', name: 'Jensen Huang', team: 1, wealth: 0, image: '13_jensen_huang.png', handle: '@caleb', company: 'NVIDIA' },
            { id: '22_pavel_durov', name: 'Pavel Durov', team: 1, wealth: 0, image: '22_pavel_durov.png', handle: '@discoesq', company: 'Telegram' },
            { id: '32_kevin_systrom', name: 'Kevin Systrom', team: 1, wealth: 0, image: '32_kevin_systrom.png', handle: '@dougdalton', company: 'Instagram' },
            { id: '35_tom_anderson', name: 'Tom Anderson', team: 1, wealth: 0, image: '35_tom_anderson.png', handle: '@betwixt.frankie', company: 'MySpace' },
            { id: '40_craig_newmark', name: 'Craig Newmark', team: 1, wealth: 0, image: '40_craig_newmark.png', handle: '@ladyhuss_', company: 'Craigslist' },
            { id: '20_jack_dorsey', name: 'Jack Dorsey', team: 1, wealth: 0, image: '20_jack_dorsey.png', handle: '@jackhite', company: 'Twitter' },
            { id: '50_jessica_alba', name: 'Jessica Alba', team: 1, wealth: 0, image: '50_jessica_alba.png', handle: '@jasche__', company: 'The Honest Company' },
            { id: '14_peter_thiel', name: 'Peter Thiel', team: 1, wealth: 0, image: '14_peter_thiel.png', handle: '@jesushands', company: 'Palantir' },
            { id: '17_sam_altman', name: 'Sam Altman', team: 1, wealth: 0, image: '17_sam_altman.png', handle: '@michaelmelwani', company: 'OpenAI' },
            { id: '11_google_founders', name: 'Larry Page & Sergey Brin', team: 1, wealth: 0, image: '11_google_founders.png', handle: '@mfgarret + @nataliesomekh_', company: 'Google' },
            { id: '15_jack_ma', name: 'Jack Ma', team: 1, wealth: 0, image: '15_jack_ma.png', handle: '@manolowashere', company: 'Alibaba' },
            { id: '08_elon_musk', name: 'Elon Musk', team: 1, wealth: 0, image: '08_elon_musk.png', handle: '@vishaal.arya', company: 'Tesla/SpaceX' },
            { id: '19_vitalik_buterin', name: 'Vitalik Buterin', team: 1, wealth: 0, image: '19_vitalik_buterin.png', handle: '@saulisgood', company: 'Ethereum' },
            { id: '02_sheryl_sandberg', name: 'Sheryl Sandberg', team: 1, wealth: 0, image: '02_sheryl_sandberg.png', handle: '@aiiisound', company: 'Meta' },
            { id: '04_brian_armstrong', name: 'Brian Armstrong', team: 1, wealth: 0, image: '04_brian_armstrong.png', handle: '@jenergizer', company: 'Coinbase' },
            { id: '29_sean_parker', name: 'Sean Parker', team: 1, wealth: 0, image: '29_sean_parker.png', handle: '@mansweater', company: 'Napster' },
            { id: '41_lucy_guo', name: 'Lucy Guo', team: 1, wealth: 0, image: '41_lucy_guo.png', handle: '@literatrix', company: 'Scale AI' },
            { id: '63_winklevoss', name: 'Winklevoss Twins', team: 1, wealth: 0, image: '63_winklevoss.png', handle: '@whoiskaybrown', company: 'Gemini' },

            // Series A(pocalypse) (Team 2)
            { id: '51_zhang_yiming', name: 'Zhang Yiming', team: 2, wealth: 0, image: '51_zhang_yiming.png', handle: '@aiiisound', company: 'ByteDance' },
            { id: '34_meg_whitman', name: 'Meg Whitman', team: 2, wealth: 0, image: '34_meg_whitman.png', handle: '@bombchips', company: 'eBay' },
            { id: '48_sam_bankman_fried', name: 'Sam Bankman-Fried', team: 2, wealth: 0, image: '48_sam_bankman-fried.png', handle: '@teamcoben', company: 'FTX' },
            { id: '49_reed_hastings', name: 'Reed Hastings', team: 2, wealth: 0, image: '49_reed_hastings.png', handle: '@stan_jericho', company: 'Netflix' },
            { id: '24_larry_ellison', name: 'Larry Ellison', team: 2, wealth: 0, image: '24_larry_ellison.png', handle: '@littleurbanachiever', company: 'Oracle' },
            { id: '21_jimmy_wales', name: 'Jimmy Wales', team: 2, wealth: 0, image: '21_jimmy_wales.png', handle: '@danieldomange', company: 'Wikipedia' },
            { id: '46_dread_pirate', name: 'Ross Ulbricht', team: 2, wealth: 0, image: '46_dread_pirate.png', handle: '@octavekitten', company: 'Silk Road' },
            { id: '25_elizabeth_holmes', name: 'Elizabeth Holmes', team: 2, wealth: 0, image: '25_elizabeth_holmes.png', handle: '@seanpaulsartre_', company: 'Theranos' },
            { id: '47_daniel_ek', name: 'Daniel Ek', team: 2, wealth: 0, image: '47_daniel_ek.png', handle: '@jacquesgreene', company: 'Spotify' },
            { id: '27_travis_kalanick', name: 'Travis Kalanick', team: 2, wealth: 0, image: '27_travis_kalanick.png', handle: '@kunaalarya', company: 'Uber' },
            { id: '37_steve_wozniak', name: 'Steve Wozniak', team: 2, wealth: 0, image: '37_steve_wozniak.png', handle: '@minibearbeats', company: 'Apple' },
            { id: '53_youtube', name: 'YouTube Founders', team: 2, wealth: 0, image: '53_youtube.png', handle: '@plascu', company: 'YouTube' },
            { id: '31_whitney_wolfe_herd', name: 'Whitney Wolfe Herd', team: 2, wealth: 0, image: '31_whitney_wolfe_herd.png', handle: '@steak.night', company: 'Bumble' },
            { id: '36_alexis_ohanian', name: 'Alexis Ohanian', team: 2, wealth: 0, image: '36_alexis_ohanian.png', handle: '@taytaystay', company: 'Reddit' },
            { id: '43_sophia_amoruso', name: 'Sophia Amoruso', team: 2, wealth: 0, image: '43_sophia_amoruso.png', handle: '@special_agent_long', company: 'Nasty Gal' },
            { id: '39_ariana_huffington', name: 'Ariana Huffington', team: 2, wealth: 0, image: '39_ariana_huffington.png', handle: '@jubileedj', company: 'Huffington Post' },
            { id: '33_martin_shkreli', name: 'Martin Shkreli', team: 2, wealth: 0, image: '33_martin_shkreli.png', handle: '@l2ex', company: 'Turing Pharmaceuticals' }
        ];

        // Game state
        let gameState = {
            companies: {
                1: { name: "Y2Ket Corp.", valuation: 0 },
                2: { name: "Series A(pocalypse)", valuation: 0 }
            },
            founders: founders,
            achievements: {},
            draggedFounder: null,
            draggedElement: null,
            dragOffset: null
        };

        // Test Firebase connection and permissions
        function testFirebaseConnection() {
            console.log('Testing Firebase connection...');
            showNotification('üîç Testing Firebase connection...');
            
            // Test 1: Check if Firebase is initialized
            if (!firebase || !database) {
                console.error('Firebase not initialized');
                showNotification('‚ùå Firebase not initialized');
                return;
            }
            
            // Test 2: Check connection status
            database.ref('.info/connected').once('value', (snapshot) => {
                if (snapshot.val() === true) {
                    console.log('‚úÖ Firebase connected');
                    showNotification('‚úÖ Firebase connected - testing permissions...');
                    
                    // Test 3: Try a simple write to test permissions
                    const testData = {
                        test: true,
                        timestamp: Date.now(),
                        message: 'Connection test from companies.html'
                    };
                    
                    database.ref('test/connection').set(testData)
                        .then(() => {
                            console.log('‚úÖ Write permission works');
                            showNotification('‚úÖ Firebase fully working!');
                            
                            // Clean up test data
                            database.ref('test').remove();
                        })
                        .catch((error) => {
                            console.error('‚ùå Write permission denied:', error);
                            showNotification('‚ùå Permission denied: ' + error.message);
                            showFirebaseRulesHelp();
                        });
                        
                } else {
                    console.error('‚ùå Firebase not connected');
                    showNotification('‚ùå Firebase not connected to internet');
                }
            });
        }
        
        function showFirebaseRulesHelp() {
            const helpMessage = `
üîß FIREBASE RULES ISSUE DETECTED

Your Firebase database rules are blocking writes. To fix:

1. Go to Firebase Console: https://console.firebase.google.com
2. Select your project: f0und3rzg4m3-b04rd
3. Go to "Realtime Database" ‚Üí "Rules"
4. Change rules to:

{
  "rules": {
    ".read": true,
    ".write": true
  }
}

5. Click "Publish"

‚ö†Ô∏è Note: This allows all reads/writes. For production, use more restrictive rules.
            `;
            
            console.log(helpMessage);
            
            // Show in a modal-like alert
            if (confirm('Firebase permission denied. Click OK to see fix instructions in console.')) {
                console.log('%c' + helpMessage, 'background: #f0f0f0; color: #000; padding: 10px;');
            }
        }

        // Enhanced sync with permission checking
        function syncToGameDatabase() {
            console.log('Starting sync to Firebase...');
            
            if (!database) {
                console.error('Firebase database not initialized');
                showNotification('‚ùå Firebase not connected');
                return;
            }
            
            if (!gameState.founders || gameState.founders.length === 0) {
                console.error('No founders to sync');
                showNotification('‚ùå No founders to sync');
                return;
            }
            
            // First test permissions
            database.ref('test/permission').set({ test: true })
                .then(() => {
                    console.log('‚úÖ Permissions OK, proceeding with sync...');
                    
                    // Now do the actual sync
                    performActualSync();
                    
                    // Clean up test
                    database.ref('test').remove();
                })
                .catch((error) => {
                    console.error('‚ùå Permission test failed:', error);
                    showNotification('‚ùå Permission denied - check Firebase rules');
                    showFirebaseRulesHelp();
                });
        }
        
        function performActualSync() {
            try {
                // Convert founders to both formats for maximum compatibility
                const foundersForGame = { 1: [], 2: [] };
                const companiesForGame = {};
                
                gameState.founders.forEach((founder, index) => {
                    // Format for moderator panel founders section
                    foundersForGame[founder.team].push({
                        name: founder.name,
                        company: founder.company || founder.name,
                        image: founder.image,
                        team: founder.team,
                        id: founder.id,
                        handle: founder.handle || '',
                        wealth: founder.wealth || 0
                    });
                    
                    // Format for companies section (for dynamic import)
                    companiesForGame[founder.id] = {
                        id: founder.id,
                        name: founder.company || founder.name,
                        founder: founder.name,
                        image: founder.image,
                        handle: founder.handle || '',
                        team: founder.team,
                        wealth: founder.wealth || 0
                    };
                });
                
                console.log('Prepared data for sync:', {
                    foundersCount: gameState.founders.length,
                    team1Count: foundersForGame[1].length,
                    team2Count: foundersForGame[2].length
                });
                
                // Save both formats to Firebase
                Promise.all([
                    database.ref('game/founders').set(foundersForGame),
                    database.ref('companies').set(companiesForGame)
                ]).then(() => {
                    showNotification('‚úÖ Founders synced to game database');
                    console.log('Successfully synced founders to Firebase');
                }).catch((error) => {
                    console.error('Firebase sync error:', error);
                    showNotification('‚ùå Sync failed: ' + error.message);
                });
                
            } catch (error) {
                console.error('Error preparing sync data:', error);
                showNotification('‚ùå Sync preparation failed');
            }
        }

        // Auto-sync to Firebase when page loads (so moderator can import)
        function autoSyncOnLoad() {
            console.log('Setting up auto-sync...');
            
            // First test Firebase, then sync
            setTimeout(() => {
                testFirebaseConnection();
                
                // Wait a bit more, then try to sync if founders are loaded
                setTimeout(() => {
                    if (gameState.founders && gameState.founders.length > 0) {
                        console.log(`Auto-syncing ${gameState.founders.length} founders...`);
                        syncToGameDatabase();
                    } else {
                        console.log('No founders loaded yet, skipping auto-sync');
                    }
                }, 2000);
            }, 1000);
        }

        // Manual sync function for testing
        function manualSync() {
            console.log('Manual sync triggered');
            syncToGameDatabase();
        }

        function loadFromGameDatabase() {
            database.ref('game/founders').once('value', (snapshot) => {
                const gameFounders = snapshot.val();
                if (gameFounders) {
                    // Convert back to playpen format
                    const loadedFounders = [];
                    
                    Object.keys(gameFounders).forEach(teamNum => {
                        gameFounders[teamNum].forEach(founder => {
                            loadedFounders.push({
                                id: founder.id || founder.name.toLowerCase().replace(/\s+/g, '_'),
                                name: founder.name,
                                team: founder.team,
                                wealth: founder.wealth || 0,
                                image: founder.image
                            });
                        });
                    });
                    
                    // Update local founders
                    gameState.founders = loadedFounders;
                    renderFounders();
                    showNotification('üì• Loaded founders from game database');
                } else {
                    showNotification('‚ùå No founder data found in game database');
                }
            });
        }

        function exportFounderData() {
            const exportData = {
                founders: gameState.founders,
                teams: {
                    1: gameState.founders.filter(f => f.team === 1),
                    2: gameState.founders.filter(f => f.team === 2)
                },
                exported: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'founders_data.json';
            link.click();
            
            showNotification('üìã Founder data exported');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Create founder card
        function createFounderCard(founder, isInZone = false) {
            const teamClass = `team-${founder.team}`;
            const style = isInZone ? '' : `style="transform: rotate(${-15 + Math.random() * 30}deg);"`;
            
            return `
                <div class="founder-card ${teamClass}" 
                     data-founder="${founder.id}"
                     draggable="true"
                     ${style}>
                    <div class="founder-card-inner">
                        <img src="assets/founders/${founder.image}" 
                             alt="${founder.name}" 
                             class="founder-image"
                             onerror="this.src='assets/founders/default.png'">
                        <div class="founder-name">${founder.name}</div>
                        <div class="founder-handle" style="font-size: 7px; color: var(--cyan); margin-top: 2px;">${founder.handle || ''}</div>
                    </div>
                </div>
            `;
        }

        // Render founders with scattered positions
        function renderFounders() {
            const container = document.getElementById('playpenContainer');
            const isMobile = window.innerWidth <= 768;
            
            container.innerHTML = '';
            
            // Render all founders
            gameState.founders.forEach((founder, index) => {
                const card = document.createElement('div');
                card.innerHTML = createFounderCard(founder);
                const founderEl = card.firstElementChild;
                
                // Position cards
                if (isMobile) {
                    const x = 5 + (Math.random() * 80);
                    const y = 5 + (Math.random() * 80);
                    
                    founderEl.style.left = `${x}%`;
                    founderEl.style.top = `${y}%`;
                    founderEl.style.transform = `rotate(${-15 + Math.random() * 30}deg)`;
                    container.style.minHeight = '600px';
                } else {
                    const x = 5 + (Math.random() * 85);
                    const y = 5 + (Math.random() * 85);
                    founderEl.style.left = `${x}%`;
                    founderEl.style.top = `${y}%`;
                    container.style.minHeight = '400px';
                }
                
                container.appendChild(founderEl);
            });
            
            // Add drag event listeners
            addDragListeners();
            
            // Add touch event support for mobile
            if (isMobile) {
                addTouchListeners();
            }
        }

        // Drag and Drop functionality
        function addDragListeners() {
            const cards = document.querySelectorAll('.founder-card');
            const zones = document.querySelectorAll('.zone');
            
            cards.forEach(card => {
                card.removeEventListener('dragstart', handleDragStart);
                card.removeEventListener('dragend', handleDragEnd);
                card.removeEventListener('click', handleFounderClick);
                
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                card.addEventListener('click', handleFounderClick);
                
                card.setAttribute('draggable', 'true');
            });
            
            zones.forEach(zone => {
                zone.removeEventListener('dragover', handleDragOver);
                zone.removeEventListener('drop', handleDrop);
                zone.removeEventListener('dragleave', handleDragLeave);
                
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragleave', handleDragLeave);
            });
            
            const playpen = document.getElementById('playpenContainer');
            playpen.removeEventListener('dragover', handleDragOver);
            playpen.removeEventListener('drop', handleDropToPlaypen);
            
            playpen.addEventListener('dragover', handleDragOver);
            playpen.addEventListener('drop', handleDropToPlaypen);
        }

        function handleDragStart(e) {
            const founderId = e.currentTarget.dataset.founder;
            gameState.draggedFounder = founderId;
            gameState.draggedElement = e.currentTarget;
            e.currentTarget.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            
            const rect = e.currentTarget.getBoundingClientRect();
            gameState.dragOffset = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        function handleDragEnd(e) {
            e.currentTarget.classList.remove('dragging');
            gameState.draggedFounder = null;
            gameState.draggedElement = null;
            gameState.dragOffset = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            if (e.currentTarget.classList.contains('zone')) {
                e.currentTarget.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            if (e.currentTarget.classList.contains('zone')) {
                e.currentTarget.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            if (!gameState.draggedFounder) return;
            
            const zoneId = e.currentTarget.id;
            const founder = gameState.founders.find(f => f.id === gameState.draggedFounder);
            
            if (founder && zoneId === 'irsZone') {
                showFounderDetails(founder);
                showToast(`Checking ${founder.name}'s records... üìä`);
            }
        }

        function handleDropToPlaypen(e) {
            e.preventDefault();
            
            if (!gameState.draggedElement || !gameState.draggedFounder) return;
            
            const playpen = document.getElementById('playpenContainer');
            const rect = playpen.getBoundingClientRect();
            
            let x = e.clientX - rect.left - (gameState.dragOffset?.x || 50);
            let y = e.clientY - rect.top - (gameState.dragOffset?.y || 60);
            
            x = Math.max(0, Math.min(x, rect.width - 100));
            y = Math.max(0, Math.min(y, rect.height - 120));
            
            gameState.draggedElement.style.left = x + 'px';
            gameState.draggedElement.style.top = y + 'px';
            
            const rotation = -15 + Math.random() * 30;
            gameState.draggedElement.style.transform = `rotate(${rotation}deg)`;
        }

        function handleFounderClick(e) {
            const founderId = e.currentTarget.dataset.founder;
            const founder = gameState.founders.find(f => f.id === founderId);
            if (founder) {
                showFounderDetails(founder);
            }
        }

        // Add touch support for mobile
        function addTouchListeners() {
            const cards = document.querySelectorAll('.founder-card');
            
            cards.forEach(card => {
                let touchItem = null;
                let touchOffset = null;
                let activeCard = null;
                
                card.addEventListener('touchstart', (e) => {
                    touchItem = e.currentTarget;
                    activeCard = e.currentTarget;
                    const touch = e.touches[0];
                    const rect = touchItem.getBoundingClientRect();
                    touchOffset = {
                        x: touch.clientX - rect.left,
                        y: touch.clientY - rect.top
                    };
                    touchItem.classList.add('dragging');
                    e.preventDefault();
                }, {passive: false});
                
                card.addEventListener('touchmove', (e) => {
                    if (!touchItem) return;
                    const touch = e.touches[0];
                    const playpen = document.getElementById('playpenContainer');
                    const rect = playpen.getBoundingClientRect();
                    
                    let x = touch.clientX - rect.left - touchOffset.x;
                    let y = touch.clientY - rect.top - touchOffset.y;
                    
                    x = Math.max(0, Math.min(x, rect.width - 80));
                    y = Math.max(0, Math.min(y, rect.height - 100));
                    
                    touchItem.style.left = x + 'px';
                    touchItem.style.top = y + 'px';
                    touchItem.style.transform = 'scale(1.1) rotate(0deg)';
                    e.preventDefault();
                }, {passive: false});
                
                card.addEventListener('touchend', (e) => {
                    if (!touchItem) return;
                    
                    touchItem.classList.remove('dragging');
                    const rotation = -15 + Math.random() * 30;
                    touchItem.style.transform = `rotate(${rotation}deg)`;
                    
                    const touch = e.changedTouches[0];
                    const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                    
                    if (elementBelow && elementBelow.closest('.irs-zone')) {
                        const founderId = activeCard.dataset.founder;
                        const founder = gameState.founders.find(f => f.id === founderId);
                        if (founder) {
                            showFounderDetails(founder);
                            showToast(`Checking ${founder.name}'s records... üìä`);
                        }
                    }
                    
                    touchItem = null;
                    touchOffset = null;
                    activeCard = null;
                }, {passive: false});
            });
        }

        // Render zones
        function renderZones() {
            const irsZone = document.getElementById('irsZone');
            const contents = irsZone.querySelector('.zone-contents');
            contents.innerHTML = '<div style="color: #ff0000; text-align: center; opacity: 0.6;">Drop a founder here to check their score</div>';
        }

        // Show founder details
        function showFounderDetails(founder) {
            const details = document.getElementById('founderDetails');
            const achievements = gameState.achievements[founder.id] || [];
            
            document.getElementById('detailsImage').src = `assets/founders/${founder.image}`;
            document.getElementById('detailsImage').onerror = function() { this.src = 'assets/founders/default.png'; };
            document.getElementById('detailsName').textContent = founder.name;
            document.getElementById('detailsWealth').textContent = `$${(founder.wealth || 0).toLocaleString()}`;
            
            // Add handle and company info
            const detailsInfo = document.querySelector('.details-info');
            const existingHandle = detailsInfo.querySelector('.founder-handle-info');
            if (existingHandle) existingHandle.remove();
            
            if (founder.handle || founder.company) {
                const handleInfo = document.createElement('div');
                handleInfo.className = 'founder-handle-info';
                handleInfo.style.cssText = 'color: var(--cyan); font-size: 14px; margin-bottom: 10px;';
                handleInfo.innerHTML = `
                    ${founder.handle ? `<div>${founder.handle}</div>` : ''}
                    ${founder.company ? `<div style="color: var(--yellow); font-size: 12px;">${founder.company}</div>` : ''}
                `;
                detailsInfo.appendChild(handleInfo);
            }
            
            const achievementsList = document.getElementById('achievementsList');
            if (achievements.length > 0) {
                achievementsList.innerHTML = achievements.map(a => 
                    `<div class="achievement-item">${a}</div>`
                ).join('');
            } else {
                achievementsList.innerHTML = '<div class="achievement-item">No achievements yet!</div>';
            }
            
            details.classList.add('active');
        }

        function closeDetails() {
            document.getElementById('founderDetails').classList.remove('active');
        }

        // Toast notifications
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255,255,255,0.9);
                color: #000;
                padding: 15px 30px;
                border-radius: 30px;
                font-weight: bold;
                z-index: 3000;
                animation: slide-up 0.3s ease-out;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }

        // Update valuations
        function updateValuations() {
            document.getElementById('valuation1').textContent = 
                `$${gameState.companies[1].valuation.toLocaleString()}`;
            document.getElementById('valuation2').textContent = 
                `$${gameState.companies[2].valuation.toLocaleString()}`;
        }

        // Load random background
        function loadRandomBackground() {
            const backgrounds = [
                { file: 'game-bg-1.jpg', weight: 3 },
                { file: 'game-bg-2.jpg', weight: 3 },
                { file: 'game-bg-3.jpg', weight: 2 },
                { file: 'game-bg-4.jpg', weight: 1 },
                { file: 'game-bg-5.jpg', weight: 1 }
            ];
            
            const totalWeight = backgrounds.reduce((sum, bg) => sum + bg.weight, 0);
            let random = Math.random() * totalWeight;
            let selectedBg = backgrounds[0].file;
            
            for (const bg of backgrounds) {
                random -= bg.weight;
                if (random <= 0) {
                    selectedBg = bg.file;
                    break;
                }
            }
            
            const liminalBg = document.querySelector('.liminal-bg');
            liminalBg.style.backgroundImage = `url('assets/backgrounds/${selectedBg}')`;
        }

        // Setup Firebase listeners
        function setupListeners() {
            database.ref('game/companies').on('value', (snapshot) => {
                const companies = snapshot.val();
                if (companies) {
                    gameState.companies = companies;
                    updateValuations();
                }
            });

            database.ref('game/founderWealth').on('value', (snapshot) => {
                const wealthData = snapshot.val() || {};
                gameState.founders.forEach(founder => {
                    if (wealthData[founder.id]) {
                        founder.wealth = wealthData[founder.id];
                    }
                });
            });

            database.ref('game/achievements').on('value', (snapshot) => {
                gameState.achievements = snapshot.val() || {};
            });
        }

        // Initialize
        window.onload = () => {
            loadRandomBackground();
            renderFounders();
            renderZones();
            setupListeners();
            updateValuations();
            
            // Auto-sync to Firebase for moderator panel integration
            autoSyncOnLoad();
        };

        // Handle resize
        window.addEventListener('resize', () => {
            renderFounders();
        });
    </script>
</body>
</html>